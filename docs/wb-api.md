# API Documentation

# Интеграция с API Wildberries

## Обзор библиотеки Wb_assistant_lib

Библиотека `Wb_assistant_lib` предоставляет удобный интерфейс для работы с API Wildberries, позволяя взаимодействовать с различными разделами API через Python. Интеграция реализована через адаптер на Node.js, который вызывает методы Python-библиотеки.

### Ключевые возможности библиотеки

#### Заказы (Orders)
- Получение списка заказов в разных статусах (новые, на сборке, собранные)
- Обновление статусов заказов
- Подтверждение и сборка заказов
- Отмена заказов
- Получение информации о клиентах

#### Поставки (Supplies)
- Создание новых поставок
- Получение информации о поставках
- Добавление заказов в поставки
- Закрытие и удаление поставок
- Перевод поставок в доставку

#### Коробы (Boxes)
- Получение списка коробов в поставке
- Добавление коробов к поставке
- Добавление заказов в короб
- Удаление заказов из короба
- Получение стикеров для коробов

#### Стикеры (Stickers)
- Получение стикеров для заказов
- Сохранение стикеров в различных форматах (PDF, PNG)
- Получение стикеров для поставок

#### Метаданные (Metadata)
- Получение и добавление метаданных заказа (SGTIN, UIN, IMEI, GTIN)

#### Пропуска (Passes)
- Управление пропусками для доставки на склады

## Архитектура интеграции

Интеграция библиотеки с проектом реализована через следующие компоненты:

1. **Python-библиотека** (`server/lib/wb_assistant_lib`) — основная библиотека, содержащая все методы для работы с API Wildberries.

2. **Мост JS-Python** (`server/src/scripts/wb_api_bridge.py`) — скрипт на Python, который принимает команды от Node.js и вызывает соответствующие методы библиотеки.

3. **Клиент API** (`server/src/api/client.js`) — JavaScript-адаптер, который запускает скрипт Python и обрабатывает его результаты.

4. **Мок-режим** — для разработки и тестирования без реального API, реализован режим мок-данных.

## Использование в проекте

### Инициализация

```javascript
import wbApiClient from '../api/client';

// Клиент автоматически инициализируется при импорте
// Используется ключ API из переменных окружения (WB_API_KEY)
```

### Получение заказов

```javascript
// Получение новых заказов
const newOrders = await wbApiClient.getNewOrders();
console.log(`Получено ${newOrders.length} новых заказов`);
```

### Работа с поставками

```javascript
// Создание новой поставки
const supply = await wbApiClient.createSupply('Новая поставка');
console.log(`Создана поставка с ID: ${supply.id}`);

// Добавление заказов в поставку
const orderIds = ['123456789', '987654321'];
await wbApiClient.addOrdersToSupply(supply.id, orderIds);
```

### Получение стикеров

```javascript
// Получение стикеров для заказов
const orderIds = ['123456789', '987654321'];
const stickers = await wbApiClient.getStickers(orderIds, 'pdf');

// Стикеры могут быть отправлены на принтер или сохранены в файл
```

## Настройка и установка

### Переменные окружения

В файле `.env` необходимо указать:

```
WB_API_KEY=ваш_ключ_api_wildberries
```

### Установка зависимостей Python

```bash
npm run wb:setup
```

### Тестирование библиотеки

```bash
npm run wb:test
```

## Работа с мок-данными

Если ключ API не настроен, библиотека автоматически переключается в мок-режим, генерируя тестовые данные для разработки:

```javascript
// Мок-данные для новых заказов
const mockNewOrders = await wbApiClient.getNewOrders();
```

## Обработка ошибок

Библиотека предоставляет детальную информацию об ошибках:

```javascript
try {
  const orders = await wbApiClient.getNewOrders();
  // Обработка успешного результата
} catch (error) {
  console.error(`Ошибка при получении заказов: ${error.message}`);
  // Обработка ошибки
}
```

## Дополнительная информация

Полная документация по библиотеке доступна в папке `server/lib/wb_assistant_lib/docs`.

