# Архитектура кросс-платформенного приложения

## Общая структура проекта

```
mobile_client/
  ├── lib/             # Общий код
  │   ├── api/         # API-интерфейсы и сервисы
  │   ├── models/      # Модели данных
  │   ├── blocs/       # Бизнес-логика (BLoC/Cubit)
  │   ├── ui/
  │   │   ├── common/  # Общие UI компоненты
  │   │   ├── mobile/  # Компоненты только для мобильных
  │   │   └── web/     # Компоненты только для веб
  │   └── utils/       # Утилиты
  ├── web/             # Веб-специфичные ресурсы
  ├── android/         # Android-специфичные файлы
  ├── ios/             # iOS-специфичные файлы
  └── test/            # Тесты
```

## Слои приложения

### 1. Слой данных

- **Модели данных**: Общие для всех платформ классы, представляющие данные приложения
- **Репозитории**: Абстракции для доступа к данным с платформо-специфичными реализациями при необходимости
- **API-клиенты**: Унифицированный доступ к серверному API с учетом особенностей платформ

### 2. Слой бизнес-логики

- **BLoC/Cubit**: Управление состоянием и бизнес-логикой, независимое от платформы
- **Сервисы**: Общая логика, используемая в различных частях приложения
- **Интерцепторы**: Обработка ошибок, аутентификация, логирование

### 3. Слой представления

- **Основные экраны**: Адаптивные представления, работающие на всех платформах
- **Платформо-специфичные компоненты**: Реализации с учетом особенностей UX для каждой платформы
- **Общие UI-компоненты**: Базовые элементы интерфейса, используемые во всем приложении

## Стратегии разделения кода

### Условная компиляция

```dart
import 'package:flutter/foundation.dart' show kIsWeb;

Widget getPlatformSpecificWidget() {
  if (kIsWeb) {
    return WebSpecificWidget();
  } else {
    return MobileSpecificWidget();
  }
}
```

### Условный импорт

```dart
// платформо-специфичная реализация интерфейса
import 'storage_interface.dart'
  if (dart.library.html) 'web_storage.dart'
  if (dart.library.io) 'mobile_storage.dart';
```

### Абстракции и внедрение зависимостей

```dart
// общий интерфейс
abstract class FileStorage {
  Future<void> saveFile(String data);
  Future<String> loadFile();
}

// фабрика для создания платформо-специфичных реализаций
class FileStorageFactory {
  static FileStorage getStorage() {
    if (kIsWeb) {
      return WebFileStorage();
    } else {
      return MobileFileStorage();
    }
  }
}
```

## Адаптивный UI

- Использование `LayoutBuilder`, `MediaQuery` и `ResponsiveBuilder` для адаптации под различные размеры экрана
- Применение различных паттернов навигации в зависимости от платформы:
  - Веб: боковая панель + tab-навигация
  - Мобильные: drawer + bottom-навигация
- Масштабирование элементов управления для удобства использования на разных устройствах

## Особенности платформ

### Веб

- Работа с URL и историей навигации браузера
- Обработка CORS и сетевых запросов
- Доступ к localStorage и особенности безопасности браузера

### Мобильные платформы

- Доступ к нативным функциям (камера, bluetooth, геолокация)
- Обработка жизненного цикла приложения
- Уведомления и фоновые задачи 